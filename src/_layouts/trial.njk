---
layout: base
schema: BlogPosting
---

<div class="region" style="--region-space-top: var(--space-l); --region-space-bottom: var(--space-l); background-color: var(--color-bg-accent);">
  <div class="wrapper flow">
    <!-- Hero Section -->
    <header class="flow" style="--flow-space: var(--space-xss); text-align: left;">
      <h1 class="gradient-text">{{ acronym | default(title) }}</h1>
      {% if title and title != acronym %}
        <p class="visually-hidden">
          <em>{{ title }}</em>
        </p>
      {% endif %}
    </header>

    <!-- Conditions, Topics, Tags -->
    <div class="cluster" style="--cluster-horizontal-alignment: left;">
      {% if conditions and conditions.length > 0 %}
        {% for conditionItem in conditions %}
          <a href="/conditions/{{ conditionItem | slugify }}/" class="button" data-small-button>
            {{ conditionItem }}
          </a>
        {% endfor %}
      {% endif %}
      {% if topics and topics.length > 0 %}
        {% for topicItem in topics %}
          <a href="/topics/{{ topicItem | slugify }}/" class="button" data-small-button>
            {{ topicItem }}
          </a>
        {% endfor %}
      {% endif %}
      {% if tags and tags.length > 0 %}
        {% for tagItem in tags %}
          {% set isCondition = false %}
          {% if conditions %}
            {% for c in conditions %}
              {% if c == tagItem %}{% set isCondition = true %}
              {% endif %}
            {% endfor %}
          {% endif %}
          {% set isTopic = false %}
          {% if topics %}
            {% for t in topics %}
              {% if t == tagItem %}{% set isTopic = true %}
              {% endif %}
            {% endfor %}
          {% endif %}
          {% if tagItem != "trial" and not isCondition and not isTopic %}
            <a class="button" href="/tags/{{ tagItem | slugify }}/" data-small-button>{{ tagItem }}</a>
          {% endif %}
        {% endfor %}
      {% endif %}
    </div>

    <!-- Metadata using sidebar composition -->
    <div class="sidebar" style="--sidebar-target-width: 40rem; --sidebar-vertical-alignment: flex-start;">
      <!-- Left column - Publication details -->
      <div>
        <h2 class="visually-hidden">Publication Details</h2>
        <dl class="cluster metadata-list text-step-min-1" style="--cluster-space: var(--space-xxs);">
          {% if datePublished %}
            <div class="cluster" style="--gutter: 0.5ch; --cluster-vertical-alignment: baseline;">
              <dt>Date Published:</dt>
              <dd>{% set definedDate = datePublished %}{% include "partials/date.njk" %}</dd>
            </div>
          {% endif %}
          {% if journal %}
            <div class="cluster" style="--gutter: 0.5ch; --cluster-vertical-alignment: baseline;">
              <dt>Journal:</dt>
              <dd>{{ journal }}</dd>
            </div>
          {% endif %}
          {% if doi %}
            <div class="cluster" style="--gutter: 0.5ch; --cluster-vertical-alignment: baseline;">
              <dt>DOI:</dt>
              <dd>
                <a href="https://doi.org/{{ doi }}" target="_blank" rel="noopener noreferrer">{{ doi }}</a>
              </dd>
            </div>
          {% endif %}
          {% if pmid %}
            <div class="cluster" style="--gutter: 0.5ch; --cluster-vertical-alignment: baseline;">
              <dt>PMID:</dt>
              <dd>
                <a href="https://pubmed.ncbi.nlm.nih.gov/{{ pmid }}" target="_blank" rel="noopener noreferrer">{{ pmid }}</a>
              </dd>
            </div>
          {% endif %}
          {% if rctIdentifier %}
            <div class="cluster" style="--gutter: 0.5ch; --cluster-vertical-alignment: baseline;">
              <dt>ClinicalTrials.gov ID:</dt>
              <dd>
                <a href="https://clinicaltrials.gov/show/{{ rctIdentifier }}" target="_blank" rel="noopener noreferrer">{{ rctIdentifier }}</a>
              </dd>
            </div>
          {% endif %}
        </dl>
      </div>
      <div>
        <h2 class="visually-hidden">PICO Question</h2>
        {% if pico %}
          <div class="text-step-1">{{ pico | markdownFormat | safe }}</div>
        {% else %}
          <p class="text-step-1">
            <em>PICO question not specified.</em>
          </p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
</div>

{# 5. Gist Section - Full Width, Dark Background #}
{% if gist %}
<div class="full | region bg-dark text-light" style="--region-space-top: var(--space-l); --region-space-bottom: var(--space-l);">
  <div class="wrapper region flow">
    <h2 class="text-step-2">The Gist</h2>
    <div>
      {{ gist | markdownFormat | safe }}
    </div>
  </div>
</div>
{% endif %}

{# This wrapper should contain the main body content and the related commentary #}
<div class="wrapper flow prose">
{{ content | safe }}
{# Main markdown content from the .md file #}

{# Related Commentary Section - Placed within the main content wrapper #}
{% if relatedCommentary and relatedCommentary.length > 0 %}
  <section class="commentary-section flow" style="margin-top: var(--space-xl);">
    <h2>Related Commentary & Discussion</h2>
    <ul class="commentary-list flow" style="--flow-space: var(--space-l); padding-left: 0; list-style: none;">
      {% for comment in relatedCommentary %}
        <li class="comment-item flow" style="--flow-space: var(--space-2xs); border-bottom: 1px solid var(--color-border); padding-bottom: var(--space-s); margin-bottom: var(--space-s);">
          <h3 class="comment-title text-step-0" style="margin-bottom: var(--space-3xs);">
            <a href="{{ comment.url }}" target="_blank" rel="noopener noreferrer">{{ comment.title }}</a>
          </h3>
          <p class="comment-meta text-step-min-1" style="color: var(--color-text-subtle);">
            <strong>Type:</strong>
            {{ comment.type }}<br>
            {% if comment.authors %}
              <strong>Authors:</strong>
              {{ comment.authors }}<br>
            {% endif %}
            {% if comment.source %}
              <strong>Source:</strong>
              {{ comment.source }}
            {% endif %}
            {% if comment.date %}
                  ({{ comment.date | formatDate }}) {# Assumes formatDate filter exists #}{% endif %}
          </p>
          {# MODIFIED LINE: Using Nunjucks 'is string' test #}
          {% if comment.notes is string and comment.notes %}
            <p class="comment-notes text-step-min-1">{{ comment.notes | markdownFormat | safe }}</p>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </section>
{% endif %}

{% include 'partials/edit-on.njk' %}
</div>
{# End of .wrapper for main content and commentary #}

{# Existing hidden h-entry block (keep as is for now) #}
<div hidden class="h-entry">
<a class="u-url" href="{{ page.url | url | absoluteUrl(meta.url) }}">{{ title }}</a>
{# This title should be the main page title (acronym or full) #}
<a class="p-name u-url" rel="author" href="{{ meta.url }}">{{ meta.author.name }}</a>
<img
      eleventy:ignore
      class="u-author h-card"
      src="{{ meta.author.avatar | url | absoluteUrl(meta.url) }}"
      alt="{{ meta.author.name }}"
/>
</div>
</div>
{# End of outer .region #}

{# Existing local CSS includes #}
{%- css "local" -%}
{%- include 'css/post.css' -%}
{%- include 'css/footnotes.css' -%}

  /* Make all dt elements bold in metadata lists */
  .metadata-list dt {
    font-weight: var(--font-bold);
  }

{%- endcss -%}